
Eloquent: Select only records from table where id exists in pivot table

$categories = Caregory::has('posts')->get();

$posts = Post::with('user', 'categories')->has('user')->whereHas('categories', function($query) {
    $query->where('active', 1);
})->get();

------------------------------------------------------------
http://stackoverflow.com/questions/30231862/laravel-eloquent-has-with-wherehas-what-do-they-mean

with() is for eager loading.

Example:

User > hasMany > Post

$users = User::with('posts')->get();
foreach($users as $user){
    $users->posts; // posts is already loaded and no additional DB query is run
}

Example:

User > hasMany > Post

$users = User::whereHas('posts', function($q){
    $q->where('created_at', '>=', '2016-01-01 00:00:00');
})->get();
// only users that have posts from this year are returned

Note also that while with('relation') will include the related table's data in the returned collection,
has('relation') and whereHas('relation') will not include the related table's data. So you may need
to call both with('relation') as well as has() or whereHas().


// deleting in db
$listingMeta->delete();
// removing from collection
$listingMetaCollection->forget($collectionKey);


Сохранение модели и её отношений

Иногда вам может быть нужно сохранить не только модель, но и все её отношения.
Для этого просто используйте метод push():

$user->push();
